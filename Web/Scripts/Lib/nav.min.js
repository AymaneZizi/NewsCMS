(function(){/*
  nav.js v0.1 - (c) Microsoft Corporation
  */
var c,a=function(a,b){return function(){return a.apply(b,arguments)}},b=Object.prototype.hasOwnProperty;c=function(b){var a;a=b;return function(){if(arguments.length>0)a=arguments[0];return a}};window.NavHistory=function(){function d(d){this.navigateAll=a(this.navigateAll,this);this.navigate=a(this.navigate,this);this._entriesArray=a(this._entriesArray,this);this.forward=a(this.forward,this);this.back=a(this.back,this);this.loadedData=a(this.loadedData,this);this.params=a(this.params,this);this.current=a(this.current,this);this.relative=a(this.relative,this);this.length=a(this.length,this);var b;this.options=d||{};this.options.params=this._extend({},this.options.params,this._asString);this.isLinkedToUrl=false;b="ko"in this.options?this.options.ko:(typeof ko!=="undefined"&&ko!==null?ko.observable:void 0)!=null;this.position=b?ko.observable(-1):c(-1);this.entries=b?ko.observableArray([]):[]}d.prototype.length=function(){return this._entriesArray().length};d.prototype.relative=function(a){return this._entriesArray()[this.position()+a]||{}};d.prototype.current=function(){return this.relative(0)};d.prototype.params=function(){return this.current().params||{}};d.prototype.loadedData=function(){return this.current().loadedData};d.prototype.back=function(){if(this.position()>0)return this.navigateAll(this.relative(-1).params)};d.prototype.forward=function(){if(this.position()<this.length()-1)return this.navigateAll(this.relative(1).params)};d.prototype._entriesArray=function(){return typeof this.entries==="function"?this.entries():this.entries};d.prototype.initialize=function(a){if(a!=null?a.linkToUrl:void 0)this._linkToUrl();else this.navigateAll((a!=null?a.params:void 0)||{});return this};d.prototype.navigate=function(b,c){var a;a=this._extend(this._extend({},this.params()),b);return this.navigateAll(a,c)};d.prototype.navigateAll=function(d,e){var j,g,i,h,b,f,k,c,m,l,a=this;d=this._normalizeParams(d);g=false;i=false;h=false;c=e!=null?e.transition:void 0;b=null;if(this.length()&&this._propsAreEqual(d,this.params()))if(e!=null?e.force:void 0){h=true;b=this.current()}else return;else if(this._propsAreEqual(d,(m=this.relative(-1))!=null?m.params:void 0)){g=true;c=c||this.current().savedTransition;b=this.relative(-1)}else if(this._propsAreEqual(d,(l=this.relative(1))!=null?l.params:void 0)){i=true;b=this.relative(1);c=c||this.current().savedTransition}else b={params:d,navEntryId:"navEntry_"+this._getUniqueSequenceValue()};f={isFirst:this.length()===0,isBack:g,isForward:i,transition:c};j=function(){var d,c;if(g)a.position(a.position()-1);else if(i)a.position(a.position()+1);else if(!h){d=a.length()-a.position()-1;a.entries().splice(a.position()+1,d,b);if(a.options.maxEntries&&a.length()>a.options.maxEntries)a.entries.shift();else{a.position(a.position()+1);typeof a.entries.valueHasMutated==="function"&&a.entries.valueHasMutated()}}if(!g&&f.transition)a.current().savedTransition=f.transition;if(a.isLinkedToUrl&&(e!=null?e.updateUrl:void 0)!==false&&!h){c=a._getUpdatedQueryString(a.params());window.NavHistory.historyProvider.pushState({url:c})}if(a.options.onNavigate)return a.options.onNavigate.call(a,a.current(),f)};if(!this.options.beforeNavigate)j();else{k=this.objectLoadToken={};this.options.beforeNavigate.call(this,b,f,function(c){if(k===a.objectLoadToken){if(c!==void 0)b.loadedData=c;return j()}})}return this};d.prototype._asString=function(a){return a===null||a===void 0?"":a.toString()};d.prototype._extend=function(f,c,e){var a,d;for(a in c){if(!b.call(c,a))continue;d=c[a];f[a]=e?e(d):d}return f};d.prototype._normalizeParams=function(b){var a;a=this.options.params||{};return this._extend(this._extend({},a),b||{},this._asString)};d.prototype._propsAreEqual=function(a,c){var d,f,e,g;if(!(a&&c))return a===c;for(d in a){if(!b.call(a,d))continue;f=a[d];if(c[d]!==f)return false}for(e in c){if(!b.call(c,e))continue;g=c[e];if(a[e]!==g)return false}return true};d.prototype._parseQueryString=function(e){var g,f,c,a,b,h,d;if(e.indexOf("?")<0)return{};f=e.substring(e.lastIndexOf("?")+1);c={};d=f.split("&");for(b=0,h=d.length;b<h;b++){g=d[b];a=g.split("=");if(a.length===2)c[a[0]]=decodeURIComponent(a[1])}return c};d.prototype._formatQueryString=function(d){var a,c,e;a="?";for(c in d){if(!b.call(d,c))continue;e=d[c];if(a!=="?")a+="&";a+=c+"="+encodeURIComponent(e)}return a};d.prototype._getUpdatedQueryString=function(g){var c,f,a,e,d;c=this._parseQueryString(window.NavHistory.historyProvider.getState().url);d=this.options.params;for(a in d){if(!b.call(d,a))continue;f=d[a];e=g[a];if(e===f)delete c[a];else c[a]=e}return this._formatQueryString(c)};d.prototype._getUniqueSequenceValue=function(){d._sequence=d._sequence||0;return(d._sequence++).toString()};d.prototype._linkToUrl=function(){var a,c=this;this.isLinkedToUrl=true;a=function(){var d,e,f,a,g;e={};d=c._parseQueryString(window.NavHistory.historyProvider.getState().url);f=c.options.params||{};for(a in d){if(!b.call(d,a))continue;g=d[a];if(f.hasOwnProperty(a))e[a]=g}return c.navigateAll(e,{updateUrl:false})};a();return window.NavHistory.historyProvider.onStateChange(a)};return d}();window.NavHistory.historyProvider={onStateChange:function(a){return History.Adapter.bind(window,"statechange",a)},pushState:function(a){return History.pushState(null,null,a.url)},getState:function(){return History.getState()},back:function(){return History.back()}};window.NavHistory.showPane=function(f){var a,c,b,e,d;a=document.getElementById(f);if(a){d=a.parentNode.childNodes;for(b=0,e=d.length;b<e;b++){c=d[b];if(c.nodeType===1)c.style.display="none"}return a.style.display="block"}}}).call(this);